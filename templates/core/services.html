{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mx-auto px-6 py-12">
    <div class="text-center mb-16" data-aos="zoom-in">
        <h1 class="text-6xl font-black uppercase italic tracking-tighter">Fast <span class="text-blue-600">Copy</span> Services</h1>
        <p class="text-slate-400 font-bold mt-2">Professional 3D Precise Pricing System</p>
    </div>

    <div class="flex overflow-x-auto space-x-6 pb-10 justify-center no-scrollbar" data-aos="fade-up">
        {% for s in services %}
        <div onclick="updateService('{{ s.name }}', '{{ s.theme_color }}', '{{ forloop.counter }}')" 
             id="tab-{{ forloop.counter }}"
             class="service-tab bg-white p-8 rounded-[2.5rem] border-2 cursor-pointer transition-all duration-500 min-w-[180px] text-center
             {% if forloop.first %} active-tab shadow-2xl -translate-y-2 {% endif %}"
             style="{% if forloop.first %} border-color: {{ s.theme_color }}; {% endif %}">
            <i class="fas {{ s.icon_class }} text-2xl mb-3" style="color: {{ s.theme_color }};"></i>
            <p class="font-black uppercase text-[10px] tracking-widest">{{ s.name }}</p>
        </div>
        {% endfor %}
    </div>

    <div id="main-card" class="max-w-6xl mx-auto bg-white rounded-[4rem] shadow-2xl border-t-[20px] p-12 transition-all duration-700" 
         style="border-color: {{ first_service.theme_color }};" data-aos="fade-up">
        
        <form id="orderForm" method="POST" action="{% url 'order-now' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="service_name" id="hidden-service-name" value="{{ first_service.name }}">
            <input type="hidden" name="total_price_hidden" id="total-price-hidden" value="0">
            <input type="hidden" name="print_type_label" id="p-label-hidden" value="B&W">
            <input type="hidden" name="side_type_label" id="s-label-hidden" value="One Side">

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">
                <div class="space-y-10">
                    <div>
                        <h3 class="text-[10px] font-black uppercase text-slate-400 mb-6 tracking-widest">1: Your Information</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <input type="text" name="name" placeholder="Full Name" required class="p-5 bg-slate-50 rounded-3xl w-full focus:ring-2 focus:ring-blue-500 outline-none border-none">
                            <input type="text" name="phone" placeholder="Phone Number" required class="p-5 bg-slate-50 rounded-3xl w-full focus:ring-2 focus:ring-blue-500 outline-none border-none">
                        </div>
                    </div>

                    <div>
                        <h3 class="text-[10px] font-black uppercase text-slate-400 mb-6 tracking-widest">2: Upload Document</h3>
                        <div class="relative p-12 border-4 border-dashed border-slate-100 rounded-[3rem] text-center hover:bg-slate-50 transition-all group">
                            <input type="file" name="document" required class="absolute inset-0 opacity-0 cursor-pointer" 
                                   onchange="handleFileUpload(event, '{% url 'calculate_pages' %}', '{{ csrf_token }}')">
                            <i class="fas fa-file-pdf text-5xl text-slate-200 group-hover:text-blue-500 transition-colors mb-4"></i>
                            <p id="file-status-text" class="font-bold text-slate-600">S.No: #001 | Click to upload PDF</p>
                            <p class="text-[9px] text-slate-300 mt-2 italic">Supports: PDF, DOCX, Images</p>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-[10px] font-black uppercase text-slate-400 mb-6 tracking-widest">3: Choose Options</h3>
                        <div class="grid grid-cols-3 gap-4">
                            <select id="pType" class="p-5 bg-slate-100 rounded-3xl font-bold appearance-none outline-none border-none">
                                <option value="2">B&W (₹2)</option>
                                <option value="10">Color (₹10)</option>
                            </select>
                            <select id="sType" class="p-5 bg-slate-100 rounded-3xl font-bold appearance-none outline-none border-none">
                                <option value="1">One Side</option>
                                <option value="1.8">Two Side</option>
                                <option value="0.5">1/2</option>
                                <option value="0.25">1/4</option>
                                <option value="0.125">1/8</option>
                            </select>
                            <input type="number" id="copies" name="copies" value="1" min="1" class="p-5 bg-slate-100 rounded-3xl font-bold text-center outline-none border-none">
                        </div>
                    </div>
                </div>

                <div class="bg-slate-50 rounded-[3.5rem] p-12 text-center flex flex-col justify-between border-4 border-white shadow-inner" data-aos="flip-right">
                    <h2 id="form-title" class="text-5xl font-black uppercase italic tracking-tighter" style="color: {{ first_service.theme_color }};">
                        {{ first_service.name }}
                    </h2>
                    <div class="py-10">
                        <span class="text-[10px] font-black uppercase text-slate-400 tracking-[0.3em]">Estimated Price</span>
                        <div class="text-9xl font-black tracking-tighter">₹<span id="price-display">0</span></div>
                        <p id="page-count-badge" class="text-[10px] font-bold text-blue-600 mt-2 uppercase tracking-widest">Pages: 0</p>
                    </div>
                    <div class="flex gap-4">
                        {% if user.is_authenticated %}
                        <button type="submit" class="flex-1 py-6 bg-slate-900 text-white rounded-full font-black uppercase text-[10px] tracking-widest shadow-xl hover:scale-105 transition-all">Order Now</button>
                        <button type="button" onclick="addToCart('{% url 'add_to_cart' %}', '{{ csrf_token }}')" class="flex-1 py-6 border-2 border-slate-200 bg-white rounded-full font-black uppercase text-[10px] tracking-widest hover:bg-slate-100 transition-all">Add to Cart</button>
                        {% else %}
                        <a href="/login" class="w-full py-6 bg-blue-600 text-white rounded-full font-black uppercase text-[10px] text-center tracking-widest shadow-xl">Login to Unlock Order</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script src="{% static 'js/main.js' %}"></script>
{% endblock %}