{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delivery Pro - FastCopies</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f172a;
            --card-dark: #1e293b;
            --accent-neon: #818cf8;
            --text-dim: #94a3b8;
            --glass: rgba(30, 41, 59, 0.7);
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-dark);
            color: #f8fafc;
            min-height: 100vh;
            background-image: radial-gradient(circle at 0% 0%, rgba(129, 140, 248, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 100% 100%, rgba(245, 158, 11, 0.05) 0%, transparent 50%);
        }

        .glass-nav {
            background: var(--glass);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 0;
        }

        .brand-logo {
            font-size: 1.4rem;
            font-weight: 800;
            color: #fff;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hero-stat {
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 1.25rem;
            height: 100%;
        }

        .stat-label {
            color: var(--text-dim);
            text-transform: uppercase;
            font-size: 0.65rem;
            font-weight: 700;
            letter-spacing: 1px;
            margin-bottom: 0.3rem;
        }

        .filter-container {
            display: flex;
            gap: 10px;
            margin-bottom: 1rem;
        }

        .filter-box {
            flex: 1;
            background: var(--glass);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            border-radius: 12px;
            padding: 10px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            outline: none;
        }

        .main-card {
            background: var(--glass);
            border-radius: 28px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
        }

        .delivery-row {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            margin-bottom: 1.5rem;
            border-left: 5px solid transparent;
            overflow: hidden;
        }

        .id-pill {
            background: rgba(129, 140, 248, 0.15);
            color: var(--accent-neon);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 800;
            display: inline-block;
        }

        .btn-call {
            background: #fff;
            color: #000 !important;
            border-radius: 12px;
            font-weight: 800;
            padding: 10px;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            transition: 0.2s;
            font-size: 0.85rem;
        }

        .btn-call:hover {
            background: var(--accent-neon);
            color: #fff !important;
        }

        .status-ready { border-left-color: #f59e0b; }
        .status-transit { border-left-color: #3b82f6; }
        .status-done { border-left-color: #10b981; }

        .custom-select-dark {
            background: #0f172a;
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: #fff;
            border-radius: 12px;
            padding: 8px;
            font-weight: 600;
            font-size: 0.8rem;
            width: 100%;
        }

        @media (max-width: 991px) {
            .mobile-stack-row {
                margin-bottom: 15px;
                padding-bottom: 10px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }

            .mobile-stack-row:last-child {
                border-bottom: none;
            }

            .btn-call {
                padding: 6px 10px;
                font-size: 0.75rem;
                border-radius: 8px;
            }

            #logout {
                font-size: 15px;
            }

            #fastcopy_head {
                font-size: 16px;
            }
        }
    </style>
</head>

<body>
    <nav class="glass-nav">
        <div class="container d-flex justify-content-between align-items-center">
            <a href="#" class="brand-logo">
                <img src="{% static 'images/fastcopies_logo.png' %}" alt="FastCopies"
                    style="height: 45px; width: auto; border-radius: 8px;">
                <div id="fastcopy_head">
                    <span style="color: var(--accent-neon); font-weight: 800; font-style: italic;">FAST</span><span
                        style="color: #fff; font-weight: 800; font-style: italic;">COPIES</span><br>
                    <span style="font-weight: 300; opacity: 0.5;">DELIVERY</span>
                </div>
            </a>
            <a href="{% url 'delivery_logout' %}" class="btn btn-outline-light btn-sm rounded-pill px-3"
                id="logout">LOGOUT ðŸšª</a>
        </div>
    </nav>

    <div class="container py-4">
        <div class="row g-3 mb-4">
            <div class="col-6 col-md-3">
                <div class="hero-stat text-center">
                    <div class="stat-label">Tasks</div>
                    <div class="h2 fw-bold mb-0 text-primary">{{ total_orders }}</div>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="hero-stat text-center">
                    <div class="stat-label">Date</div>
                    <div class="h2 fw-bold mb-0">{% now "d M" %}</div>
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="hero-stat d-flex align-items-center justify-content-between px-4">
                    <div>
                        <div class="stat-label">System Status</div>
                        <span class="h5 fw-bold text-success mb-0">ðŸŸ¢ CONNECTED</span>
                    </div>
                    <button onclick="window.location.reload()" class="btn btn-dark rounded-circle p-2">ðŸ”„</button>
                </div>
            </div>
        </div>

        <form method="GET" class="filter-container">
            <select name="date_filter" class="filter-box" onchange="this.form.submit()">
                <option value="all" {% if date_filter == 'all' %}selected{% endif %}>ðŸ“… All Time</option>
                <option value="today" {% if date_filter == 'today' %}selected{% endif %}>ðŸ“… Today</option>
                <option value="last_7_days" {% if date_filter == 'last_7_days' %}selected{% endif %}>ðŸ“… Last 7D</option>
                <option value="last_30_days" {% if date_filter == 'last_30_days' %}selected{% endif %}>ðŸ“… Last 30D</option>
            </select>

            <select name="status" class="filter-box" onchange="this.form.submit()">
                <option value="all" {% if status_filter == 'all' %}selected{% endif %}>ðŸ“¦ All Status</option>
                <option value="Ready" {% if status_filter == 'Ready' %}selected{% endif %}>ðŸ“¦ Ready</option>
                <option value="Out for Delivery" {% if status_filter == 'Out for Delivery' %}selected{% endif %}>ðŸšš Transit</option>
                <option value="Delivered" {% if status_filter == 'Delivered' %}selected{% endif %}>âœ… Done</option>
            </select>
        </form>

        <div class="main-card">
            <h5 class="fw-bold mb-4">Delivery Monitor <span class="small text-dim ms-2">({{ total_orders }} results)</span></h5>

            {% if orders %}
            {% for order in orders %}
            <div class="delivery-row p-4 
                    {% if order.status == 'Ready' %}status-ready
                    {% elif order.status == 'Out for Delivery' %}status-transit
                    {% elif order.status == 'Delivered' %}status-done{% endif %}">

                <div class="row align-items-center g-3">
                    <div class="col-12 col-lg-2 mobile-stack-row">
                        <div class="stat-label">Order ID</div>
                        <span class="id-pill">#{{ order.order_id }}</span>
                    </div>

                    <div class="col-6 col-lg-3 mobile-stack-row">
                        <div class="stat-label">Customer</div>
                        <div class="fw-bold text-white small text-truncate">
                            {{ order.customer_name|default:order.user.get_full_name|default:order.user.username }}
                        </div>
                    </div>

                    <div class="col-6 col-lg-2 mobile-stack-row">
                        <div class="stat-label">Destination</div>
                        <div class="small text-white opacity-75 text-truncate" style="font-size: 0.8rem;">
                            {{ order.location|default:order.user.profile.address }}
                        </div>
                    </div>

                    <div class="col-6 col-lg-2 mobile-stack-row">
                        <div class="stat-label">Mobile</div>
                        <div class="fw-bold small" style="color: var(--accent-neon);">
                            {{ order.mobile|default:order.user.profile.mobile }}
                        </div>
                    </div>

                    <div class="col-6 col-lg-2 mobile-stack-row" style="min-width: 140px;">
                        <div class="stat-label">Update Status</div>
                        <form method="POST" action="{% url 'update_delivery_status' order.id %}">
                            {% csrf_token %}
                            <select name="status" class="custom-select-dark" onchange="this.form.submit()">
                                <option value="Pending" {% if order.status == 'Pending' %}selected{% endif %}>ðŸ•’ Pending</option>
                                <option value="Ready" {% if order.status == 'Ready' %}selected{% endif %}>ðŸ“¦ Ready</option>
                                <option value="Out for Delivery" {% if order.status == 'Out for Delivery' %}selected{% endif %}>ðŸšš Transit</option>
                                <option value="Delivered" {% if order.status == 'Delivered' %}selected{% endif %}>âœ… Done</option>
                            </select>
                        </form>
                    </div>

                    <div class="col-12 col-lg-1 flex-grow-1">
                        <a href="tel:{{ order.mobile|default:order.user.profile.mobile }}" class="btn-call">
                            ðŸ“ž CALL
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="text-center py-5">
                <div style="font-size: 3rem; opacity: 0.1;">ðŸ“¦</div>
                <p class="small text-muted">No shipments found matching criteria.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>